<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>新規会員登録</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f0f8ff;
      --text: #000080;
      --primary: #4682b4;
      --primary-hover: #5a9bd3;
      --card: #ffffff;
      --border: #d0d7de;
    }
    * { box-sizing: border-box; }
    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans JP", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      padding: 16px;
    }
    .container {
      width: 100%;
      max-width: 720px;
      background-color: var(--card);
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 24px rgba(0,0,0,0.08);
    }
    h2 {
      margin: 0 0 8px;
      text-align: center;
      color: var(--primary);
      font-size: 1.25rem;
    }
    h3 {
      margin: 0 0 24px;
      text-align: center;
      font-weight: 500;
      color: #0f3554;
      font-size: 1rem;
    }
    .field {
      display: grid;
      grid-template-columns: 120px 1fr;
      gap: 12px;
      align-items: center;
      margin-bottom: 14px;
    }
    .field label {
      justify-self: end;
      color: var(--text);
    }
    .field input[type="text"],
    .field input[type="email"],
    .field input[type="tel"],
    .field input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 16px;
    }
    .actions {
      margin-top: 12px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    button[type="submit"] {
      min-width: 140px;
      background-color: var(--primary);
      color: #fff;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    button[type="submit"]:hover { background-color: var(--primary-hover); }
    .note {
      margin-top: 12px;
      font-size: 12px;
      color: #5a6b7a;
      text-align: center;
    }
    .link {
      margin-top: 16px;
      text-align: center;
    }
    .link a { color: var(--primary); text-decoration: none; }
    .link a:hover { text-decoration: underline; }

    @media (max-width: 520px) {
      .field { grid-template-columns: 1fr; }
      .field label { justify-self: start; }
    }
  </style>
</head>
<body>
  <div class="container">
    <form id="registration-form" novalidate>
      <h2><strong><em>JTB Web販 AWS勉強会 新規会員登録サイト</em></strong></h2>
      <h3>必要事項をご記入の上、登録ボタンを押してください</h3>

      <div class="field">
        <label for="id">ユーザID</label>
        <!-- 初期値を入れたい場合: value="user-001" -->
        <input id="id" name="id" type="text" inputmode="latin" autocomplete="off" required placeholder="user-001" />
      </div>

      <div class="field">
        <label for="name">名前</label>
        <!-- value="Tetsuya Suzuki" を設定すると初期入力されます -->
        <input id="name" name="name" type="text" autocomplete="name" required placeholder="Tetsuya Suzuki" />
      </div>

      <div class="field">
        <label for="email">メールアドレス</label>
        <input id="email" name="email" type="email" autocomplete="email" required placeholder="tetsuya.suzuki@dxc.com" />
      </div>

      <div class="field">
        <label for="age">年齢</label>
        <input id="age" name="age" type="number" min="0" step="1" inputmode="numeric" placeholder="35" />
      </div>

      <div class="field">
        <label for="address">住所</label>
        <input id="address" name="address" type="text" placeholder="Tokyo, Japan" />
      </div>

      <div class="field">
        <label for="tel">電話番号</label>
        <input id="tel" name="tel" type="tel" autocomplete="tel" placeholder="080-1234-5678" />
      </div>

      <div class="actions">
        <button type="submit" id="register">登録</button>
      </div>

      <p class="note">このフォームは id・name・email・age・address・tel を送信します。</p>

      <div class="link">
        <a href="htttps:jtb.com/" target="_blank" rel="noopener noreferrer">
          JTB Web販 AWS 勉強会へ
        </a>
      </div>
    </form>
  </div>

 <script>
  document.addEventListener("DOMContentLoaded", () => {
    const form = document.getElementById("registration-form");
    const endpoint = "https://ywqxo7roj5.execute-api.ap-northeast-1.amazonaws.com/prod/users";

    function validate({ id, name, email, age, tel }) {
      if (!id || !name || !email) {
        alert("すべての必須項目（ID・名前・メールアドレス）を入力してください。");
        return false;
      }
      const emailRe = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRe.test(email)) {
        alert("メールアドレスの形式が正しくありません。");
        return false;
      }
      if (age !== "" && age !== null) {
        const n = Number(age);
        if (!Number.isInteger(n) || n < 0) {
          alert("年齢は0以上の整数で入力してください。");
          return false;
        }
      }
      if (tel) {
        // 簡易チェック: 半角数字とハイフンのみ、または数列(9~12桁程度)
        const telRe = /^[0-9\-+\s]{8,20}$/;
        if (!telRe.test(tel)) {
          alert("電話番号の形式が正しくありません。");
          return false;
        }
      }
      return true;
    }

    form.addEventListener("submit", async (event) => {
      event.preventDefault();

      const payload = {
        id: document.getElementById("id").value.trim(),
        name: document.getElementById("name").value.trim(),
        email: document.getElementById("email").value.trim(),
        // 年齢は数値に変換（未入力なら undefined にする）
        age: (() => {
          const v = document.getElementById("age").value.trim();
          return v === "" ? undefined : Number(v);
        })(),
        address: document.getElementById("address").value.trim() || undefined,
        tel: document.getElementById("tel").value.trim() || undefined
      };

      if (!validate(payload)) return;

      // 送信するJSONを明示（例として完全なオブジェクトを送る）
      // サーバ側が未定義フィールドを受け取れない場合は削除して送る
      const sendBody = {};
      Object.keys(payload).forEach(k => {
        if (payload[k] !== undefined && payload[k] !== "") sendBody[k] = payload[k];
      });

      try {
        const res = await fetch(endpoint, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(sendBody),
          // mode: "cors" // 必要なら有効化
        });

        const ct = res.headers.get("Content-Type") || "";
        let data = null;
        if (ct.includes("application/json")) {
          try {
            data = await res.json();
          } catch (parseErr) {
            const text = await res.text().catch(() => "");
            data = text ? { raw: text } : null;
          }
        } else {
          const text = await res.text().catch(() => "");
          data = text ? { raw: text } : null;
        }

        if (res.ok) {
          alert("登録が完了しました！送信データ:\n" + JSON.stringify(sendBody, null, 2));
          form.reset();
        } else {
          const msg = (data && (data.message || data.error)) 
            ? (data.message || data.error)
            : `ステータス: ${res.status}`;
          alert("登録に失敗しました。 " + msg);
        }
      } catch (e) {
        alert("通信エラーが発生しました: " + e.message);
      }
    });
  });
</script>
</body>
</html>